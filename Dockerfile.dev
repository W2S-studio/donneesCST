# Development-specific Dockerfile (Dockerfile.dev)
FROM maven:3.9.4-eclipse-temurin-21

WORKDIR /workspace

# Copy Maven configuration and install dependencies
COPY pom.xml ./
RUN mvn dependency:go-offline -B

# Copy source code (will be mounted in docker-compose)
COPY src ./src

# Install inotify-tools for file watching
RUN apt-get update && apt-get install -y inotify-tools || true

# Command to watch for changes in src, static, and templates, rebuild, and run the app
CMD ["sh", "-c", "echo 'Starting hot-reload...' && mvn clean package -DskipTests && java -jar target/*.jar & while inotifywait -e modify,create,delete -r src/main/java src/main/resources/static src/main/resources/templates; do echo 'Change detected, rebuilding...'; mvn clean package -DskipTests && pkill -f 'java -jar' && echo 'Restarting app...'; java -jar target/*.jar & done"]